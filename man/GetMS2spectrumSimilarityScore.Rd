% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/MainFunctions.R
\name{GetMS2SpectrumSimilarityScore}
\alias{GetMS2SpectrumSimilarityScore}
\title{Calculate MS2 Consine Similarity Score for a Given Glycan/Adduct and Generate Annotated Heatmap}
\usage{
GetMS2SpectrumSimilarityScore(
  ms_data,
  spectrum_matching_result,
  glycan_composition_str,
  adduct_type = adduct_type_default,
  bin_width,
  ms2_range_start,
  ms2_range_end
)
}
\arguments{
\item{ms_data}{A \code{Spectra} object containing the raw mass spectrometry data.}

\item{spectrum_matching_result}{A data frame containing matching results. Must include columns:
\code{ms2_spectrum_id}, \code{glycan_string}, \code{ms2_retention_time},
\code{ms2_total_ion_current}, and columns for adduct types.}

\item{glycan_composition_str}{Character. The glycan composition string to filter by (e.g., 'Hex3HexNAc4dHex1').}

\item{adduct_type}{A named numeric vector defining the adduct state (e.g., \code{c(H = 2, Na = 0, K = 0)}).}

\item{bin_width}{Numeric. The width of the m/z bins for vectorization.}

\item{ms2_range_start}{Numeric. The starting m/z value for the similarity calculation.}

\item{ms2_range_end}{Numeric. The ending m/z value for the similarity calculation.}
}
\value{
A \code{list} containing:
\itemize{
\item \code{similarity_score}: A symmetric numeric matrix of pairwise Cosine similarities.
\item \code{similarity_score_heatmap}: A \code{HeatmapList} object rendered with the legend on the left.
}
}
\description{
This function filters MS2 spectra based on a specific glycan composition and adduct type,
performs m/z binning, calculates pairwise Cosine similarity scores, and generates
a square-tiled heatmap with a top TIC (Total Ion Current) barplot annotation.

This function extracts MS2 spectra that match a specified glycan composition string and
an exact adduct configuration from \code{spectrum_matching_result}, bins each MS2 spectrum
into a common m/z grid, and computes a pairwise cosine similarity matrix.
A \code{ComplexHeatmap} heatmap is generated with a top barplot annotation showing
\code{sqrt(ms2_total_ion_current)}.
}
\details{
The function ensures data alignment between the similarity matrix and TIC metadata using
\code{match()}. The heatmap is generated with fixed square tiles and a customized
color gradient from white to deep red.
}
\examples{
\dontrun{
# Example usage:
result <- GetMS2SpectrumSimilarityScore(
  ms_data = raw_spectra,
  spectrum_matching_result = match_df,
  glycan_composition_str = "Hex3HexNAc4dHex1",
  adduct_type = c(H = 2, Na = 0, K = 0),
  bin_width = 0.3,
  ms2_range_start = 100,
  ms2_range_end = 2000
)

# Access the matrix
print(result$similarity_score)
}
}
